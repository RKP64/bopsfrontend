server {
    listen 8000;

    # Hide NGINX identification
    server_tokens off;
    add_header Server "" always;

    # Serve React app
    root /usr/share/nginx/html;
    index index.html;

    # React SPA fallback
    location / {
        try_files $uri /index.html;
    }

    # Proxy to BASE_URL (MDA App)
    location /api-mda/ {
        proxy_pass https://bial-genai-regulatory-mda-app-02-c8eag5fch2hkbfa2.southindia-01.azurewebsites.net/;
        proxy_http_version 1.1;

        proxy_set_header Host bial-genai-regulatory-mda-app-02-c8eag5fch2hkbfa2.southindia-01.azurewebsites.net;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        proxy_connect_timeout 310s;
        proxy_send_timeout 310s;
        proxy_read_timeout 310s;

        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";

        proxy_ssl_verify off;  # For testing only — remove in production
    }

    # Proxy blob-proxy endpoint to BASE_URL_2 (ff API)
    # This must come before /api-ff/ to handle /api-ff/blob-proxy specifically
    # In production, frontend generates /api-ff/blob-proxy?blob=... URLs
    location /api-ff/blob-proxy {
        proxy_pass https://bial-genai-regulatory-backend-01-bpdeeyd2h7hsc6bp.southindia-01.azurewebsites.net/blob-proxy;
        proxy_http_version 1.1;

        proxy_set_header Host bial-genai-regulatory-backend-01-bpdeeyd2h7hsc6bp.southindia-01.azurewebsites.net;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        proxy_connect_timeout 310s;
        proxy_send_timeout 310s;
        proxy_read_timeout 310s;

        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";

        #proxy_ssl_verify off;  # For testing only — remove in production
    }

    # Proxy to BASE_URL_2 (ff API) - handles all other /api-ff/* requests
    location /api-ff/ {
        proxy_pass https://bial-genai-regulatory-backend-01-bpdeeyd2h7hsc6bp.southindia-01.azurewebsites.net/;
        proxy_http_version 1.1;

        proxy_set_header Host bial-genai-regulatory-backend-01-bpdeeyd2h7hsc6bp.southindia-01.azurewebsites.net;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        proxy_connect_timeout 310s;
        proxy_send_timeout 310s;
        proxy_read_timeout 310s;

        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";

        #proxy_ssl_verify off;  # For testing only — remove in production
    }
}
